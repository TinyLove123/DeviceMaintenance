<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Trang chi ti·∫øt b√°o c√°o</title>
    <th:block th:replace="base :: bootstrap"></th:block>
</head>
<body>
    <div th:replace="base :: header"></div>

    <main class="container mt-4">
        <h1 class="mb-4">Chi ti·∫øt B√°o c√°o & Thi·∫øt b·ªã</h1>

        <div class="row">
            <!-- üîº KHUNG S·ª∞ C·ªê -->
            <div class="col-md-6">
                <div class="card mb-4 shadow">
                    <div class="card-header bg-danger text-white">
                        <h5>S·ª± c·ªë</h5>
                    </div>
                    <div class="card-body" th:if="${Incident != null}">
                        <h5 th:text="${Incident.title}"></h5>
                        <p><strong>M√¥ t·∫£ chi ti·∫øt:</strong> <span th:text="${Incident.detailDescribe}"></span></p>
                        <p><strong>Ng∆∞·ªùi g·ª≠i:</strong> <span th:text="${Incident.senderId.firstName + ' ' + Incident.senderId.lastName}"></span></p>
                        <p><strong>Ng√†y b√°o c√°o:</strong> 
                            <span th:text="${Incident.reportDate != null ? #dates.format(Incident.reportDate, 'dd/MM/yyyy HH:mm:ss') : 'Ch∆∞a c√≥'}"></span>
                        </p>
                        <p><strong>Tr·∫°ng th√°i:</strong> <span th:text="${Incident.status}"></span></p>

                        <!-- ‚úÖ FORM c·∫≠p nh·∫≠t tr·∫°ng th√°i -->
                        <form th:action="@{|/admin/incident-device/${Incident.deviceId.id}/incident-update/${Incident.id}|}" method="post">
                            <div class="mb-3">
                                <label for="status" class="form-label">C·∫≠p nh·∫≠t tr·∫°ng th√°i:</label>
                                <select name="status" id="status" class="form-control" onchange="toggleEmployeeDropdown(this.value)">
                                    <option value="PENDING_APPROVAL" th:selected="${Incident.status == 'PENDING_APPROVAL'}">PENDING_APPROVAL</option>
                                    <option value="APPROVED" th:selected="${Incident.status == 'APPROVED'}">APPROVED</option>
                                    <option value="REJECTED" th:selected="${Incident.status == 'REJECTED'}">REJECTED</option>
                                </select>
                            </div>

                            <div id="approvedFields" style="display: none;">
                                <div class="mb-3">
                                    <label for="employeeId" class="form-label">Nh√¢n vi√™n x·ª≠ l√Ω:</label>
                                    <select name="employeeId" id="employeeId" class="form-control">
                                        <option value="">-- Ch·ªçn nh√¢n vi√™n --</option>
                                        <option th:each="emp : ${employees}" th:value="${emp.id}" th:text="${emp.firstName + ' ' + emp.lastName}"></option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label for="startDate" class="form-label">Ng√†y b·∫Øt ƒë·∫ßu th·ª±c hi·ªán:</label>
                                    <input type="datetime-local" name="startDate" id="startDate" class="form-control" />
                                </div>

                                <div class="mb-3">
                                    <label for="endDate" class="form-label">Ng√†y k·∫øt th√∫c d·ª± ki·∫øn:</label>
                                    <input type="datetime-local" name="endDate" id="endDate" class="form-control" />
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary">C·∫≠p nh·∫≠t</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- üîΩ KHUNG THI·∫æT B·ªä -->
            <div class="col-md-6">
                <div class="card mb-4 shadow">
                    <div class="card-header bg-primary text-white">
                        <h5>Th√¥ng tin Thi·∫øt b·ªã</h5>
                    </div>
                    <div class="card-body" th:if="${Incident.deviceId != null}">
                        <p><strong>T√™n thi·∫øt b·ªã:</strong> <span th:text="${Incident.deviceId.nameDevice}"></span></p>
                        <p><strong>Ng√†y mua:</strong> 
                            <span th:text="${Incident.deviceId.purchaseDate != null ? #dates.format(Incident.deviceId.purchaseDate, 'dd/MM/yyyy') : 'Ch∆∞a c√≥'}"></span>
                        </p>
                        <p>
                            <strong>V·ªã tr√≠ hi·ªán t·∫°i:</strong>
                            <span th:text="${Incident.deviceId.currentLocationId != null ? Incident.deviceId.currentLocationId.wardId.fullName
                                  + ', ' + Incident.deviceId.currentLocationId.wardId.provinceCode.fullName 
                                  + ', ' + Incident.deviceId.currentLocationId.address : 'Ch∆∞a c·∫≠p nh·∫≠t'}"></span>
                        </p>
                        <p><strong>Lo·∫°i thi·∫øt b·ªã:</strong> <span th:text="${Incident.deviceId.categoryId.type}"></span></p>
                        <!--<p><strong>M√£ thi·∫øt b·ªã:</strong> <span th:text="${Incident.deviceId.serialNumber}"></span></p>-->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div th:replace="base :: footer"></div>

    <script>
        function toggleEmployeeDropdown(value) {
            const empSelect = document.getElementById('approvedFields');
            empSelect.style.display = (value === 'APPROVED') ? 'block' : 'none';
        }

        document.addEventListener("DOMContentLoaded", function () {
            toggleEmployeeDropdown(document.getElementById('status').value);
        });
    </script>
</body>
</html>
