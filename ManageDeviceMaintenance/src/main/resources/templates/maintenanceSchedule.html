<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>LỊCH BẢO TRÌ</title>
    <th:block th:replace="base :: bootstrap"></th:block>


</head>
<body>
    <div th:replace="base :: header"></div>

    <main class="container my-4">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Ngày bắt đầu</th>
                    <th>Tiến trình</th>
                    <th>Thiết bị</th>
                    <th>Nhân viên</th>
                    <th>Tình trạng</th>
                    <th>Cập nhật</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="m : ${maintenanceSchedules}">
                    <td th:text="${m.startDate}"></td>
                    <td th:text="
                        ${m.progress == 'in_progress'} ? 'Đang thực hiện' :
                        (${m.progress == 'completed'} ? 'Hoàn thành' :
                        (${m.progress == 'in_completed'} ? 'Chưa xử lý' : 'Không xác định'))"
                        th:classappend="
                        ${m.progress == 'in_progress'} ? 'text-warning fw-bold bg-light' :
                        (${m.progress == 'completed'} ? 'text-success fw-bold bg-light' :
                        (${m.progress == 'in_completed'} ? 'text-danger fw-bold bg-light' : 'text-dark fw-bold bg-light'))">
                    </td>
                    <td th:text="${m.deviceId.nameDevice}"></td>
                    <td th:text="${m.employeeId != null ? m.employeeId.firstName + ' ' + m.employeeId.lastName : 'Chưa xếp'}"
                        th:classappend="${m.employeeId == null} ? 'text-danger fw-bold' : ''"></td>
                    <td>
                        <span th:attr="data-start=${m.startDate}" class="remaining-days"></span>
                    </td>
                    <td>
                        <a th:href="@{/admin/maintenance-schedule-manager/{id}/maintenance-schedule-detail(id=${m.id})}" class="btn btn-primary">Chỉnh sửa</a>
                    </td>
                </tr>
            </tbody>
        </table>
    </main>

    <div th:replace="base :: footer"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const rows = document.querySelectorAll('.remaining-days');
            const now = new Date();

            rows.forEach(span => {
                const startDateStr = span.getAttribute('data-start');
                const startDate = new Date(startDateStr);
                const diffTime = startDate - now;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays > 0) {
                    span.textContent = `Còn ${diffDays} ngày`;
                    span.classList.add('text-success', 'fw-bold');
                } else {
                    span.textContent = `Quá hạn ${-diffDays} ngày`;
                    span.classList.add('text-danger', 'fw-bold');
                }
            });
        });
    </script>
</body>
</html>
